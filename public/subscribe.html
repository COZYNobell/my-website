<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë‚ ì”¨ ì •ë³´ êµ¬ë…</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; min-height: 80vh; background-color: #f4f4f4; }
        .container { background-color: white; padding: 30px; border-radius: 8px; box-shadow: 0 0 15px rgba(0,0,0,0.1); width: 350px; text-align: center; }
        h1 { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; text-align: left; }
        input[type="email"] { width: 95%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px; }
        button { width: 100%; padding: 10px; background-color: #17a2b8; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #138496; }
        .message { margin-top:15px; }
        .message a { color: #007bff; text-decoration: none; }
        #response-message { margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ë‚ ì”¨ ì •ë³´ ì´ë©”ì¼ êµ¬ë… ğŸŒ¦ï¸</h1>
        <p>ì´ë©”ì¼ì„ ë“±ë¡í•˜ì‹œë©´ ë§¤ì¼ ë‚ ì”¨ ì •ë³´ë¥¼ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.</p>
        <form id="subscribe-form">
            <div>
                <label for="email">ì´ë©”ì¼ ì£¼ì†Œ:</label>
                <input type="email" id="email" name="email" placeholder="ì´ë©”ì¼ ì…ë ¥" required>
            </div>
            <button type="submit">êµ¬ë…í•˜ê¸°</button>
        </form>
        <div id="response-message"></div> <div class="message">
            <p><a href="/">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a></p>
        </div>
    </div>

    <script>
        document.getElementById("subscribe-form").addEventListener("submit", async (e) => {
            e.preventDefault(); // ê¸°ë³¸ í¼ ì œì¶œ ë°©ì§€

            const emailInput = document.getElementById("email");
            const email = emailInput.value;
            const responseMessageDiv = document.getElementById("response-message");
            responseMessageDiv.textContent = ""; // ì´ì „ ë©”ì‹œì§€ ì´ˆê¸°í™”

            // ì¤‘ìš”: <API_GATEWAY_URL> ë¶€ë¶„ì€ ì‹¤ì œ ìƒì„±í•  API Gateway ì—”ë“œí¬ì¸íŠ¸ URLë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.
            const apiUrl = "https://https://7jn93wrich.execute-api.ap-southeast-2.amazonaws.com/sns-subscribe"; // ì˜ˆì‹œ URL (ì‹¤ì œë¡œëŠ” /prod ìŠ¤í…Œì´ì§€ë‚˜ ì‚¬ìš©í•˜ì‹œëŠ” ìŠ¤í…Œì´ì§€ëª…)

            if (!email) {
                responseMessageDiv.textContent = "ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
                responseMessageDiv.style.color = "red";
                return;
            }

            try {
                responseMessageDiv.textContent = "êµ¬ë… ìš”ì²­ ì¤‘...";
                responseMessageDiv.style.color = "blue";

                const res = await fetch(apiUrl, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email: email }), // ì„œë²„ Lambdaê°€ ë°›ì„ ë°ì´í„° í˜•ì‹ì— ë§ì¶¤
                });

                const result = await res.json(); // Lambda ì‘ë‹µì´ JSON í˜•íƒœë¼ê³  ê°€ì •

                if (res.ok) {
                    responseMessageDiv.textContent = result.message || "êµ¬ë… ìš”ì²­ì´ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤! í™•ì¸ ì´ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.";
                    responseMessageDiv.style.color = "green";
                    emailInput.value = ""; // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                } else {
                    responseMessageDiv.textContent = "êµ¬ë… ì‹¤íŒ¨: " + (result.message || "ì„œë²„ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                    responseMessageDiv.style.color = "red";
                }
            } catch (err) {
                console.error("êµ¬ë… ìš”ì²­ ì¤‘ JavaScript ì˜¤ë¥˜:", err);
                responseMessageDiv.textContent = "ì˜¤ë¥˜ ë°œìƒ: " + err.message + ". ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
                responseMessageDiv.style.color = "red";
            }
        });
    </script>
</body>
</html>
