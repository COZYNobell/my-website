{
  "title": "서버 CPU 사용률",
  "type": "gauge",
  "targets": [
    {
      "expr": "avg by (instance) (100 - (rate(node_cpu_seconds_total{job=\"node_exporter\", mode=\"idle\"}[5m]) * 100))",
      "legendFormat": "{{server_role}} ({{instance}})",
      "refId": "A"
    }
  ]
},
{
  "title": "서버 메모리 사용률",
  "type": "gauge",
  "targets": [
    {
      "expr": "100 * (1 - (node_memory_MemAvailable_bytes{job=\"node_exporter\"} / node_memory_MemTotal_bytes{job=\"node_exporter\"}))",
      "legendFormat": "{{server_role}} ({{instance}})",
      "refId": "A"
    }
  ]
},
{
  "title": "서버 네트워크 트래픽",
  "type": "timeseries",
  "targets": [
    {
      "expr": "rate(node_network_receive_bytes_total{job=\"node_exporter\"}[5m])",
      "legendFormat": "받기: {{server_role}} ({{instance}})",
      "refId": "A"
    },
    {
      "expr": "rate(node_network_transmit_bytes_total{job=\"node_exporter\"}[5m])",
      "legendFormat": "보내기: {{server_role}} ({{instance}})",
      "refId": "B"
    }
  ]
}
{
  "title": "총 요청 수",
  "type": "stat",
  "targets": [
    {
      "expr": "sum(increase(http_request_duration_seconds_count{job=\"weather_app\"}[$__range]))",
      "refId": "A"
    }
  ]
},
{
  "title": "총 서버 에러 (5xx)",
  "type": "stat",
  "targets": [
    {
      "expr": "sum(increase(http_request_duration_seconds_count{job=\"weather_app\", status_code=~\"5..\"}[$__range]))",
      "refId": "A"
    }
  ]
},
{
  "title": "총 클라이언트 에러 (4xx)",
  "type": "stat",
  "targets": [
    {
      "expr": "sum(increase(http_request_duration_seconds_count{job=\"weather_app\", status_code=~\"4..\"}[$__range]))",
      "refId": "A"
    }
  ]
}
{
  "title": "API 경로별 요청 빈도",
  "type": "timeseries",
  "targets": [
    {
      "expr": "sum(rate(http_request_duration_seconds_count{job=\"weather_app\"}[5m])) by (route)",
      "legendFormat": "{{route}}",
      "refId": "A"
    }
  ]
},
{
  "title": "API 경로별 평균 응답 속도",
  "type": "timeseries",
  "targets": [
    {
      "expr": "sum(rate(http_request_duration_seconds_sum{job=\"weather_app\"}[5m])) by (route) / sum(rate(http_request_duration_seconds_count{job=\"weather_app\"}[5m])) by (route)",
      "legendFormat": "{{route}}",
      "refId": "A"
    }
  ]
},
{
  "title": "95%ile 응답 속도",
  "type": "timeseries",
  "targets": [
    {
      "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket{job=\"weather_app\"}[5m])) by (le, route))",
      "legendFormat": "{{route}}",
      "refId": "A"
    }
  ]
},
{
  "title": "가장 인기 있는 API Top 5",
  "type": "table",
  "targets": [
    {
      "expr": "topk(5, sum(rate(http_request_duration_seconds_count{job=\"weather_app\"}[5m])) by (route))",
      "legendFormat": "{{route}}",
      "instant": true,
      "refId": "A"
    }
  ]
},
{
  "title": "가장 느린 API Top 5",
  "type": "table",
  "targets": [
    {
      "expr": "topk(5, sum(rate(http_request_duration_seconds_sum{job=\"weather_app\"}[5m])) by (route) / sum(rate(http_request_duration_seconds_count{job=\"weather_app\"}[5m])) by (route))",
      "legendFormat": "{{route}}",
      "instant": true,
      "refId": "A"
    }
  ]
}
